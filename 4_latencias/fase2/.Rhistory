nrow(mal_ajustados)
mal_ajustados[,c(14,17,21,19,
15,18,22,20)]
mal_ajustados$n
massa <- subset(dados,  !(dados$n %in% mal_ajustados$n))
analista <- subset(dados,(dados$n %in% mal_ajustados$n))
nrow(dados)
nrow(massa) + nrow(analista)
form.min_lat <- min_lat ~ (lock + p0156 + p06 + p23 + p237 + p4 + p1 + p15 + p0
)
form.max_lat <- max_lat ~ (lock + p0156 + p06 + p23 + p237 + p4 + p1 + p15 + p0
)
Z0 <- mc_id(massa) # Identidade
fit <-
mcglm(linear_pred = c(form.min_lat,
form.max_lat),
matrix_pred = list(c(Z0),
c(Z0)),
link = c("log", "log"),
variance = c("poisson_tweedie", "poisson_tweedie"),
control_algorithm = list(verbose = T,
tuning = 0.1,
max_iter = 60,
tol = 1e-1),
power_fixed = c(F,F),
data = massa)
fit <-
mcglm(linear_pred = c(form.min_lat,
form.max_lat),
matrix_pred = list(c(Z0),
c(Z0)),
link = c("log", "log"),
variance = c("poisson_tweedie", "poisson_tweedie"),
control_algorithm = list(verbose = T,
tuning = 0.1,
max_iter = 60,
tol = 1e-4),
power_fixed = c(F,F),
data = massa)
fit <-
mcglm(linear_pred = c(form.min_lat,
form.max_lat),
matrix_pred = list(c(Z0),
c(Z0)),
link = c("log", "log"),
variance = c("poisson_tweedie", "poisson_tweedie"),
control_algorithm = list(verbose = T,
tuning = 0.1,
max_iter = 60,
tol = 1e-3),
power_fixed = c(F,F),
data = massa)
fit <-
mcglm(linear_pred = c(form.min_lat,
form.max_lat),
matrix_pred = list(c(Z0),
c(Z0)),
link = c("log", "log"),
variance = c("poisson_tweedie", "poisson_tweedie"),
control_algorithm = list(verbose = T,
tuning = 0.1,
max_iter = 60,
tol = 1e-2),
power_fixed = c(F,F),
data = massa)
fit <-
mcglm(linear_pred = c(form.min_lat,
form.max_lat),
matrix_pred = list(c(Z0),
c(Z0)),
link = c("log", "log"),
variance = c("poisson_tweedie", "poisson_tweedie"),
control_algorithm = list(verbose = T,
tuning = 0.1,
max_iter = 60,
tol = 1e-1),
power_fixed = c(F,F),
data = massa)
fit <-
mcglm(linear_pred = c(form.min_lat,
form.max_lat),
matrix_pred = list(c(Z0),
c(Z0)),
link = c("log", "log"),
variance = c("poisson_tweedie", "poisson_tweedie"),
control_algorithm = list(verbose = T,
tuning = 0.2,
max_iter = 60,
tol = 1e-1),
power_fixed = c(F,F),
data = massa)
fit <-
mcglm(linear_pred = c(form.min_lat,
form.max_lat),
matrix_pred = list(c(Z0),
c(Z0)),
link = c("log", "log"),
variance = c("poisson_tweedie", "poisson_tweedie"),
control_algorithm = list(verbose = T,
tuning = 0.1,
max_iter = 60,
tol = 1e-1),
power_fixed = c(F,F),
data = massa)
matplot(fit$IterationCovariance, type = 'l', xlim = c(1,60))
summary(fit)
coef(fit, type = 'beta')
coef(fit, type = 'tau')
coef(fit, type = 'power')
## chol(vcov) inversa
chol_inv <- Matrix::chol(fit$inv_C)
## Resíduos empilhados
res <- as.numeric(residuals(fit, type = 'raw'))
## Produto matricial
residuos <- as.numeric(chol_inv%*%res)
## Preditos
preditos <- fit$fitted
## Dataframe
res_pred <- data.frame(index = 1:nrow(massa),
resp = c(rep('min_lat', nrow(massa)),
rep('max_lat', nrow(massa))),
observado = c(massa$min_lat,massa$max_lat),
preditos = preditos,
pearson = residuos,
raw = res
)
## Resíduo Pearson
mean = MASS::fitdistr(res_pred$pearson,
densfun = "normal")$estimate[1]
sd = MASS::fitdistr(res_pred$pearson,
densfun = "normal")$estimate[2]
g1 <- ggplot(data = res_pred, aes(x=pearson))+
geom_histogram(fill=1,alpha=0.5, col = 1)+
theme_bw()+
xlab('Resíduos')+
ylab('Densidade')+
geom_vline(xintercept = 0, col = 2, lty = 2, lwd = 1)+
stat_function(fun = function(x) dnorm(x,
mean = mean,
sd = sd) * 1400,
color = "darkred", size = 1) +
ggtitle('Resíduo Pearson')
mean2 = MASS::fitdistr(res_pred$raw,
densfun = "normal")$estimate[1]
sd2 = MASS::fitdistr(res_pred$raw,
densfun = "normal")$estimate[2]
g2 <- ggplot(data = res_pred, aes(x=raw))+
geom_histogram(fill=1,alpha=0.5, col = 1)+
theme_bw()+
xlab('Resíduos')+
ylab('Densidade')+
geom_vline(xintercept = 0, col = 2, lty = 2, lwd = 1)+
stat_function(fun = function(x) dnorm(x,
mean = mean2,
sd = sd2) * 1700,
color = "darkred", size = 1) +
ggtitle('Resíduo cru')
g1
g2
## Resíduo Pearson
mean = MASS::fitdistr(res_pred$pearson,
densfun = "normal")$estimate[1]
sd = MASS::fitdistr(res_pred$pearson,
densfun = "normal")$estimate[2]
g1 <- ggplot(data = res_pred, aes(x=pearson))+
geom_histogram(fill=1,alpha=0.5, col = 1)+
theme_bw()+
xlab('')+
ylab('')+
geom_vline(xintercept = 0, col = 2, lty = 2, lwd = 1)+
facet_wrap(~resp, scales = 'free') +
ggtitle('Resíduo Pearson')
mean2 = MASS::fitdistr(res_pred$raw,
densfun = "normal")$estimate[1]
sd2 = MASS::fitdistr(res_pred$raw,
densfun = "normal")$estimate[2]
g2 <- ggplot(data = res_pred, aes(x=raw))+
geom_histogram(fill=1,alpha=0.5, col = 1)+
theme_bw()+
xlab('')+
ylab('')+
geom_vline(xintercept = 0, col = 2, lty = 2, lwd = 1)+
facet_wrap(~resp, scales = 'free') +
ggtitle('Resíduo cru')
g1
g2
## Resíduos vs Predito
g1 <- ggplot(data = res_pred, aes(y=pearson,x=preditos))+
geom_point(alpha=0.5)+
theme_bw()+
geom_smooth(col=2, method = 'lm', se=F)+
xlab('Preditos')+
ylab('Resíduos') +
ggtitle('Resíduo Pearson')
g2 <- ggplot(data = res_pred, aes(y=raw,x=preditos))+
geom_point(alpha=0.5)+
theme_bw()+
geom_smooth(col=2, method = 'lm', se=F)+
xlab('Preditos')+
ylab('Resíduos') +
ggtitle('Resíduo cru')
ggpubr::ggarrange(g1,g2)
## Resíduos vs Predito
g1 <- ggplot(data = res_pred, aes(y=pearson,x=preditos))+
geom_point(alpha=0.5)+
theme_bw()+
geom_smooth(col=2, method = 'lm', se=F)+
xlab('')+
ylab('Resíduos') +
ggtitle('Resíduo Pearson') + facet_wrap(~resp, scales = 'free')
g2 <- ggplot(data = res_pred, aes(y=raw,x=preditos))+
geom_point(alpha=0.5)+
theme_bw()+
geom_smooth(col=2, method = 'lm', se=F)+
xlab('Preditos')+
ylab('Resíduos') +
ggtitle('Resíduo cru') + facet_wrap(~resp, scales = 'free')
ggpubr::ggarrange(g1,g2, nrow = 2)
## qqplot
g1 <- ggplot(data = res_pred,
mapping = aes(sample = pearson)) +
geom_qq(alpha = 0.5) + geom_qq_line(col = 2)+
theme_bw() +
xlab('Quantis teóricos')+
ylab('Quantis amostrais') +
ggtitle('Resíduo Pearson')
g2 <- ggplot(data = res_pred,
mapping = aes(sample = raw)) +
geom_qq(alpha = 0.5) + geom_qq_line(col = 2)+
theme_bw() +
xlab('Quantis teóricos')+
ylab('Quantis amostrais') +
ggtitle('Resíduo cru')
ggpubr::ggarrange(g1,g2)
## Observado vs Predito
ggplot(data = res_pred, aes(x=observado,y=preditos))+
geom_point(alpha=0.5)+
theme_bw()+
geom_smooth(method = 'lm')+
xlab('Observado')+
ylab('Predito') + facet_wrap(~resp, scales = 'free') +
geom_abline(slope = 1, intercept = 1, col = 2, lwd = 1.1)
# SAIDA DO MODELO
resumo <- summary(fit)
# TAU E P PARA CADA RESPOSTA
round(resumo$`Resp.Variable 1`$Power,2)
round(resumo$`Resp.Variable 1`$tau,2)
round(resumo$`Resp.Variable 2`$Power,2)
round(resumo$`Resp.Variable 2`$tau,2)
confint(fit)[21:25,]
beta_min <- data.frame(name = rownames(resumo$`Resp.Variable 1`$Regression),
exp_est = exp(round(resumo$`Resp.Variable 1`$Regression$Estimates,2)),
ic_min = as.vector(exp(confint(fit)[1:10,])[,1]),
ic_max = as.vector(exp(confint(fit)[1:10,])[,2]))
beta_max <- data.frame(name = rownames(resumo$`Resp.Variable 2`$Regression),
exp_est = exp(round(resumo$`Resp.Variable 2`$Regression$Estimates,2)),
ic_min = as.vector(exp(confint(fit)[11:20,])[,1]),
ic_max = as.vector(exp(confint(fit)[11:20,])[,2]))
beta_min[,2:4] <- round(beta_min[,2:4],2)
beta_max[,2:4] <- round(beta_max[,2:4],2)
beta_min
beta_max
beta_min
beta_min[,2:4] <- round(beta_min[,2:4],2)
beta_max[,2:4] <- round(beta_max[,2:4],2)
beta_min
beta_max
## p0156
paste0('Para cada unidade de aumento no uso da porta ', beta_min$name[3],
' a media da latencia minima fica multiplicada por ', beta_min$exp_est[3],
' mantendo fixos os valores das demais variáveis. Com 95% de confiança o intervalo entre ',
beta_min$ic_min[3], ' e ', beta_min$ic_max[3], ' realmente contém o parâmetro.')
##p41
paste0('A media da latencia minima quando é usada a porta ', beta_min$name[7],
' é ', beta_min$exp_est[7], ' vezes a media de quando ela não é usada, mantendo fixos os valores das demais variáveis. Com 95% de confiança o intervalo entre ',
beta_min$ic_min[7], ' e ', beta_min$ic_max[7], ' realmente contém o parâmetro.')
# ANOVA
anova(fit)
# MANOVA
mc_manova(fit)
form.min_lat
predito <- function(lock, p0156, p06,
p23, p237, p4,
p1, p15, p0){
betas <- data.frame(beta_name = c('intercept',
'lock', 'p0156',
'p06', 'p23',
'p237', 'p4', 'p1',
'p15', 'p0'),
estim_min = coef(fit, type = 'beta')$Estimates[1:10],
estim_max = coef(fit, type = 'beta')$Estimates[11:20])
min <- exp(
betas$estim_min[1] +           #intercept
betas$estim_min[2]  *  lock  + #lock
betas$estim_min[3]  *  p0156 + #p0156
betas$estim_min[4]  *  p06   + #p06
betas$estim_min[5]  *  p23   + #p23
betas$estim_min[6]  *  p237  + #p237
betas$estim_min[7]  *  p4    + #p4
betas$estim_min[8]  *  p1    + #p1
betas$estim_min[9]  *  p15   + #p15
betas$estim_min[10] *  p0     #p0
)
max <- exp(
betas$estim_max[1] +            #intercept
betas$estim_max[2]  *  lock  +  #lock
betas$estim_max[3]  *  p0156 +  #p0156
betas$estim_max[4]  *  p06   +  #p06
betas$estim_max[5]  *  p23   +  #p23
betas$estim_max[6]  *  p237  +  #p237
betas$estim_max[7]  *  p4    +  #p4
betas$estim_max[8]  *  p1    +  #p1
betas$estim_min[9]  *  p15   +  #p15
betas$estim_min[10] *  p0       #p0
)
out <- data.frame(min_lat = min,
max_lat = max)
return(out)
}
dados[sample(nrow(massa),1),c('lock',
'p0156',
'p06',
'p23',
'p237',
'p4',
'p1',
'p15',
'p0',
'min_lat',
'max_lat')]
predito(lock  =  0,
p0156 =  0,
p06   =  0,
p23   =  0,
p237  =  0,
p4    =  0,
p1    =  0,
p15   =  0,
p0    =  0)
predito(lock  =  0,
p0156 =  0,
p06   =  1,
p23   =  1,
p237  =  0,
p4    =  0,
p1    =  0,
p15   =  0,
p0    =  0)
dados[sample(nrow(massa),1),c('lock',
'p0156',
'p06',
'p23',
'p237',
'p4',
'p1',
'p15',
'p0',
'min_lat',
'max_lat')]
predito(lock  =  0,
p0156 =  1,
p06   =  1,
p23   =  0,
p237  =  0,
p4    =  0,
p1    =  1,
p15   =  0,
p0    =  0)
dados[sample(nrow(massa),1),c('lock',
'p0156',
'p06',
'p23',
'p237',
'p4',
'p1',
'p15',
'p0',
'min_lat',
'max_lat')]
predito(lock  =  0,
p0156 =  0,
p06   =  1,
p23   =  0,
p237  =  0,
p4    =  0,
p1    =  0,
p15   =  0,
p0    =  0)
dados[sample(nrow(massa),1),c('lock',
'p0156',
'p06',
'p23',
'p237',
'p4',
'p1',
'p15',
'p0',
'min_lat',
'max_lat')]
predito(lock  =  1,
p0156 =  1,
p06   =  1,
p23   =  1,
p237  =  0,
p4    =  1,
p1    =  0,
p15   =  0,
p0    =  0)
dados[sample(nrow(massa),1),c('lock',
'p0156',
'p06',
'p23',
'p237',
'p4',
'p1',
'p15',
'p0',
'min_lat',
'max_lat')]
predito(lock  =  0,
p0156 =  0,
p06   =  1,
p23   =  1,
p237  =  0,
p4    =  0,
p1    =  0,
p15   =  0,
p0    =  0)
dados[sample(nrow(massa),1),c('lock',
'p0156',
'p06',
'p23',
'p237',
'p4',
'p1',
'p15',
'p0',
'min_lat',
'max_lat')]
dados[sample(nrow(massa),1),c('lock',
'p0156',
'p06',
'p23',
'p237',
'p4',
'p1',
'p15',
'p0',
'min_lat',
'max_lat')]
dados[sample(nrow(massa),1),c('lock',
'p0156',
'p06',
'p23',
'p237',
'p4',
'p1',
'p15',
'p0',
'min_lat',
'max_lat')]
predito(lock  =  0,
p0156 =  0,
p06   =  0,
p23   =  0,
p237  =  1,
p4    =  1,
p1    =  0,
p15   =  0,
p0    =  0)
dados[sample(nrow(massa),1),c('lock',
'p0156',
'p06',
'p23',
'p237',
'p4',
'p1',
'p15',
'p0',
'min_lat',
'max_lat')]
dados[sample(nrow(massa),1),c('lock',
'p0156',
'p06',
'p23',
'p237',
'p4',
'p1',
'p15',
'p0',
'min_lat',
'max_lat')]
dados[sample(nrow(massa),1),c('lock',
'p0156',
'p06',
'p23',
'p237',
'p4',
'p1',
'p15',
'p0',
'min_lat',
'max_lat')]
predito(lock  =  0,
p0156 =  1,
p06   =  1,
p23   =  1,
p237  =  1,
p4    =  1,
p1    =  0,
p15   =  0,
p0    =  0)
