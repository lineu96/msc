---
output:
  html_document:                    # Classe de documento.
    toc: true                       # Exibir sum?rio.
    toc_depth: 2                    # Profundidade do sum?rio.
    toc_float:                      # Sum?rio flutuante na borda.
      collapsed: true
      smooth_scroll: true
    number_sections: false           # Se??es numeradas.
    theme: cosmo
    #spacelab
    #default,cerulean,journal,flatly,readable,spacelab,
    #united,cosmo,lumen,paper,sandstone,simplex,yeti
    
    highlight: espresso
    #default, tango, pygments, kate, monochrome, espresso, zenburn, haddock, and textmate
    #css: styles.css                 # Caminho para arquivo CSS.
    fig_width: 7                    # Lagura das figuras.
    fig_height: 6                   # Altura das figuras.
    fig_caption: true               # Exibica??o de legenda.
    fig_align: 'center'
    code_folding: hide              # Esconder/exibir bloco de c?digo.
#    keep_md: true                   # Manter o arquivo md.
    #template: quarterly_report.html # Caminho para o template.  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = FALSE,fig.align='center', fig.width=5, fig.height=5)

#--------------------------------------------------------------
setwd("~/msc/4_latencias")
#--------------------------------------------------------------

library(tidyverse)
library(gridExtra)
library(ggpubr)

source('funcoes.R')

#--------------------------------------------------------------

# DADOS
#--------------------------------------------------------------

dados <- read.csv2('tissei.csv', header = T, sep = ',')

str(dados)

names(dados) <- c('n', 'inst', 'lock', 'set_rex', 'segment',
                  'mem_xchg', 'p0156', 'p06', 'p23', 'p237', 
                  'p4', 'p1', 'p15', 'p015', 'p5', 'p0', 
                  'p05', 'p01', 'p6', 'min_lat', 'max_lat')


dados_min <- subset(dados, dados$min_lat < 21)
  nrow(dados) - nrow(dados_min)
  
dados_max <- subset(dados, dados$max_lat < 41)
  nrow(dados) - nrow(dados_max)

scat2 <- function(porta){
  
  g1 <-   ggplot(data = dados_min, 
                 mapping = aes_string(x=porta, 
                                      y='min_lat')) +
    geom_point() + 
    #geom_smooth(se=F, 
    #            linetype = 
    #              'longdash', 
    #            col = '#2EFE64') + 
    geom_smooth(method = 'lm', 
                se = F, 
                col= 2)+ theme_bw()+
    theme(legend.title = element_blank())+
    xlab(porta) + ylab('Latência mínima') + ggtitle('')  
  
  g2 <-   ggplot(data = dados_max, 
                 mapping = aes_string(x=porta, 
                                      y='max_lat')) +
    geom_point() + 
    #geom_smooth(se=F, 
    #            linetype = 
    #              'longdash', 
    #            col = '#2EFE64') + 
    geom_smooth(method = 'lm', 
                se = F, 
                col= 2)+ theme_bw()+
    theme(legend.title = element_blank())+
    xlab(porta) + ylab('Latência máxima') + ggtitle('')  
  
  
  
  ggarrange(g1,g2,
            nrow = 1, ncol = 2, 
            common.legend = TRUE, 
            legend="bottom",
            #labels = paste0(porta, ' em função das latências'),
            font.label = list(size = 15))
  
}

```

---

<center>
<font size="6"> 
<p align=”center”> <b> Análise gráfica bivariada </b> </center>
</font>
</center>

---

Foram criados 2 subsets para análise:

- Um para análise da latência mínima, restringindo a latência mínima entre 0 e 20.

 - E outro para análise da latência máxima, restringindo a latência máxima entre 0 e 40.

---

# Latência em função das indicadoras e segment

---

## Latência mínima {.tabset .tabset-fade}

---

### lock

<center>
```{r, echo=FALSE}
pander::pander(data.frame(Níveis = c(0,1),
           Média = c(round(tapply(dados_min$min_lat, dados_min$lock, mean)[1], 3),
                     round(tapply(dados_min$min_lat, dados_min$lock, mean)[2], 3)),
           Desv_pad = c(round(tapply(dados_min$min_lat, dados_min$lock, sd)[1], 3),
                     round(tapply(dados_min$min_lat, dados_min$lock, sd)[2], 3)))
)

```
</center>

---

### set_rex

<center>
```{r, echo=FALSE, fig.width=5, fig.height=5}
pander::pander(data.frame(Níveis = c(0,1),
           Média = c(round(tapply(dados_min$min_lat, dados_min$set_rex, mean)[1], 3),
                     round(tapply(dados_min$min_lat, dados_min$set_rex, mean)[2], 3)),
           Desv_pad = c(round(tapply(dados_min$min_lat, dados_min$set_rex, sd)[1], 3),
                     round(tapply(dados_min$min_lat, dados_min$set_rex, sd)[2], 3)))
)
```
</center>

---

### mem_xchg

<center>
```{r, echo=FALSE, fig.width=5, fig.height=5}
pander::pander(data.frame(Níveis = c(0,1),
           Média = c(round(tapply(dados_min$min_lat, dados_min$mem_xchg, mean)[1], 3),
                     round(tapply(dados_min$min_lat, dados_min$mem_xchg, mean)[2], 3)),
           Desv_pad = c(round(tapply(dados_min$min_lat, dados_min$mem_xchg, sd)[1], 3),
                     round(tapply(dados_min$min_lat, dados_min$mem_xchg, sd)[2], 3)))
)
```
</center>

---

### segment

<center>
```{r, echo=FALSE, fig.width=5, fig.height=5}
seg <- factor(dados_min$segment, levels = 0:6)

pander::pander(data.frame(Níveis = 0:6,
                          Média = c(round(tapply(dados_min$min_lat, seg, mean)[1], 3),
                                    round(tapply(dados_min$min_lat, seg, mean)[2], 3),
                                    round(tapply(dados_min$min_lat, seg, mean)[3], 3),
                                    round(tapply(dados_min$min_lat, seg, mean)[4], 3),
                                    round(tapply(dados_min$min_lat, seg, mean)[5], 3),
                                    round(tapply(dados_min$min_lat, seg, mean)[6], 3),
                                    round(tapply(dados_min$min_lat, seg, mean)[7], 3)),
                          
                          Desv_pad = c(round(tapply(dados_min$min_lat, seg, sd)[1], 3),
                                       round(tapply(dados_min$min_lat, seg, sd)[2], 3),
                                       round(tapply(dados_min$min_lat, seg, sd)[3], 3),
                                       round(tapply(dados_min$min_lat, seg, sd)[4], 3),
                                       round(tapply(dados_min$min_lat, seg, sd)[5], 3),
                                       round(tapply(dados_min$min_lat, seg, sd)[6], 3),
                                       round(tapply(dados_min$min_lat, seg, sd)[7], 3)))
)

```
</center>

## Latência máxima {.tabset .tabset-fade}

### lock

<center>
```{r, echo=FALSE}
pander::pander(data.frame(Níveis = c(0,1),
           Média = c(round(tapply(dados_max$max_lat, dados_max$lock, mean)[1], 3),
                     round(tapply(dados_max$max_lat, dados_max$lock, mean)[2], 3)),
           Desv_pad = c(round(tapply(dados_max$max_lat, dados_max$lock, sd)[1], 3),
                     round(tapply(dados_max$max_lat, dados_max$lock, sd)[2], 3)))
)

```
</center>

---

### set_rex

<center>
```{r, echo=FALSE, fig.width=5, fig.height=5}
pander::pander(data.frame(Níveis = c(0,1),
           Média = c(round(tapply(dados_max$max_lat, dados_max$set_rex, mean)[1], 3),
                     round(tapply(dados_max$max_lat, dados_max$set_rex, mean)[2], 3)),
           Desv_pad = c(round(tapply(dados_max$max_lat, dados_max$set_rex, sd)[1], 3),
                     round(tapply(dados_max$max_lat, dados_max$set_rex, sd)[2], 3)))
)
```
</center>

---

### mem_xchg

<center>
```{r, echo=FALSE, fig.width=5, fig.height=5}
pander::pander(data.frame(Níveis = c(0,1),
           Média = c(round(tapply(dados_max$max_lat, dados_max$mem_xchg, mean)[1], 3),
                     round(tapply(dados_max$max_lat, dados_max$mem_xchg, mean)[2], 3)),
           Desv_pad = c(round(tapply(dados_max$max_lat, dados_max$mem_xchg, sd)[1], 3),
                     round(tapply(dados_max$max_lat, dados_max$mem_xchg, sd)[2], 3)))
)
```
</center>

---

### segment

<center>
```{r, echo=FALSE, fig.width=5, fig.height=5}
seg <- factor(dados_max$segment, levels = 0:6)

pander::pander(data.frame(Níveis = 0:6,
                          Média = c(round(tapply(dados_max$max_lat, seg, mean)[1], 3),
                                    round(tapply(dados_max$max_lat, seg, mean)[2], 3),
                                    round(tapply(dados_max$max_lat, seg, mean)[3], 3),
                                    round(tapply(dados_max$max_lat, seg, mean)[4], 3),
                                    round(tapply(dados_max$max_lat, seg, mean)[5], 3),
                                    round(tapply(dados_max$max_lat, seg, mean)[6], 3),
                                    round(tapply(dados_max$max_lat, seg, mean)[7], 3)),
                          
                          Desv_pad = c(round(tapply(dados_max$max_lat, seg, sd)[1], 3),
                                       round(tapply(dados_max$max_lat, seg, sd)[2], 3),
                                       round(tapply(dados_max$max_lat, seg, sd)[3], 3),
                                       round(tapply(dados_max$max_lat, seg, sd)[4], 3),
                                       round(tapply(dados_max$max_lat, seg, sd)[5], 3),
                                       round(tapply(dados_max$max_lat, seg, sd)[6], 3),
                                       round(tapply(dados_max$max_lat, seg, sd)[7], 3)))
)

```
</center>

---

# Gráficos {.tabset .tabset-fade}

---

## Latência mínima 

<center>
```{r, echo=FALSE, fig.width=8, fig.height=5, warning=FALSE}
g1 <-ggplot(data = dados_min,
       aes(x = factor(lock),
           y = min_lat)) + geom_boxplot() +
  xlab('lock') + ylab('Latência mínima') + theme_bw()

g2 <-ggplot(data = dados_min,
       aes(x = factor(set_rex),
           y = min_lat)) + geom_boxplot() +
  xlab('set_rex') + ylab('Latência mínima') + theme_bw()

g3 <-ggplot(data = na.omit(dados_min),
       aes(x = factor(mem_xchg),
           y = min_lat)) + geom_boxplot() +
  xlab('mem_xchg') + ylab('Latência mínima') + theme_bw()

g4 <-ggplot(data = dados_min,
       aes(x = factor(segment),
           y = min_lat)) + geom_boxplot() +
  xlab('segment') + ylab('Latência mínima') + theme_bw()

ggarrange(g1,g2,g3,g4,
          nrow = 2, ncol = 2)


```
</center>

---

## Latência máxima

<center>
```{r, echo=FALSE, fig.width=8, fig.height=5, warning=FALSE}
g1 <-ggplot(data = dados_max,
            aes(x = factor(lock),
                y = max_lat)) + geom_boxplot() +
  xlab('lock') + ylab('Latência máxima') + theme_bw()

g2 <-ggplot(data = dados_max,
            aes(x = factor(set_rex),
                y = max_lat)) + geom_boxplot() +
  xlab('set_rex') + ylab('Latência máxima') + theme_bw()

g3 <-ggplot(data = na.omit(dados_max),
            aes(x = factor(mem_xchg),
                y = max_lat)) + geom_boxplot() +
  xlab('mem_xchg') + ylab('Latência máxima') + theme_bw()

g4 <-ggplot(data = dados_max,
            aes(x = factor(segment),
                y = max_lat)) + geom_boxplot() +
  xlab('segment') + ylab('Latência máxima') + theme_bw()

ggarrange(g1,g2,g3,g4,
          nrow = 2, ncol = 2)

```
</center>

---

## Latência mínima (log)

<center>
```{r, echo=FALSE, fig.width=8, fig.height=5, warning=FALSE}
g1 <-ggplot(data = dados_min,
            aes(x = factor(lock),
                y = log(min_lat))) + geom_boxplot() +
  xlab('lock') + ylab('Latência mínima') + theme_bw()

g2 <-ggplot(data = dados_min,
            aes(x = factor(set_rex),
                y = log(min_lat))) + geom_boxplot() +
  xlab('set_rex') + ylab('Latência mínima') + theme_bw()

g3 <-ggplot(data = na.omit(dados_min),
            aes(x = factor(mem_xchg),
                y = log(min_lat))) + geom_boxplot() +
  xlab('mem_xchg') + ylab('Latência mínima') + theme_bw()

g4 <-ggplot(data = dados_min,
            aes(x = factor(segment),
                y = log(min_lat))) + geom_boxplot() +
  xlab('segment') + ylab('Latência mínima') + theme_bw()

ggarrange(g1,g2,g3,g4,
          nrow = 2, ncol = 2)

```
</center>

---

## Latência máxima (log)

```{r, echo=FALSE, fig.width=8, fig.height=5, warning=FALSE}

g1 <-ggplot(data = dados_max,
            aes(x = factor(lock),
                y = log(max_lat))) + geom_boxplot() +
  xlab('lock') + ylab('Latência máxima') + theme_bw()

g2 <-ggplot(data = dados_max,
            aes(x = factor(set_rex),
                y = log(max_lat))) + geom_boxplot() +
  xlab('set_rex') + ylab('Latência máxima') + theme_bw()

g3 <-ggplot(data = na.omit(dados_max),
            aes(x = factor(mem_xchg),
                y = log(max_lat))) + geom_boxplot() +
  xlab('mem_xchg') + ylab('Latência máxima') + theme_bw()

g4 <-ggplot(data = dados_max,
            aes(x = factor(segment),
                y = log(max_lat))) + geom_boxplot() +
  xlab('segment') + ylab('Latência máxima') + theme_bw()

ggarrange(g1,g2,g3,g4,
          nrow = 2, ncol = 2)

```

---

# Latência em função das portas {.tabset .tabset-fade}

---

## p0156

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p0156')


```
</center>

---

## p06

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p06')


```
</center>

---

## p23

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p23')


```
</center>

---

## p237

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p237')


```
</center>

---

## p4

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p4')


```
</center>

---

## p1

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p1')


```
</center>

---

## p15

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p15')


```
</center>

---

## p015

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p015')


```
</center>

---

## p5

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p5')


```
</center>

---

## p0

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p0')


```
</center>

---

## p05

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p05')


```
</center>

---

## p01

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p01')


```
</center>

---

## p6

<center>
```{r,echo=FALSE,fig.width=10, fig.height=4}
scat2('p6')


```
</center>

---

# Correlograma {.tabset .tabset-fade}

## subset min

<center>
```{r,echo=FALSE,fig.width=7, fig.height=7}
numericas1 <- dados_min[,c(7:17,20,21)]

names(numericas1)[c(12,13)] <- c('min', 'max')

cor1 <- cor(numericas1, method = 'pearson')

corrplot::corrplot.mixed(cor1, 
                         upper = 'ellipse',
                         tl.pos = "d"#,
                         #diag = 'n'
)
```
</center>

---

## subset max

<center>
```{r,echo=FALSE,fig.width=7, fig.height=7}
numericas2 <- dados_max[,c(7:16,20,21)]

names(numericas2)[c(11,12)] <- c('min', 'max')

cor2 <- cor(numericas2, method = 'pearson')

corrplot::corrplot.mixed(cor2, 
                         upper = 'ellipse',
                         tl.pos = "d"#,
                         #diag = 'n'
)


```
</center>

---

<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>